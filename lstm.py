financial_services_list = [
    # Banks
    "HDFCBANK.NS", "ICICIBANK.NS", "SBIN.NS", "KOTAKBANK.NS", "AXISBANK.NS",
    "INDUSINDBK.NS", "BANKBARODA.NS", "PNB.NS", "IDFCFIRSTB.NS", "UNIONBANK.NS",
    "CANBK.NS", "FEDERALBNK.NS", "AUBANK.NS", "IDBI.NS", "BANKINDIA.NS",
    # NBFCs & Housing Finance
    "BAJFINANCE.NS", "BAJAJFINSV.NS", "CHOLAFIN.NS", "SHRIRAMFIN.NS", "SUNDARMFIN.NS",
    "MUTHOOTFIN.NS", "L&TFH.NS", "POONAWALLA.NS", "M&MFIN.NS", "LICHSGFIN.NS",
    "INDIANB.NS", "PFC.NS", "RECLTD.NS",
    # Insurance & AMCs
    "HDFCLIFE.NS", "SBILIFE.NS", "ICICIPRULI.NS", "ICICIGI.NS", "NIACL.NS",
    "HDFCAMC.NS", "NIPPONIND.NS", "UTIAMC.NS",
    # Others
    "PAYTM.NS", "IEX.NS", "MAHABANK.NS", "CENTRALBK.NS", "UCOBANK.NS", "IOB.NS"
]

it_services_list = [
    "TCS.NS", "INFY.NS", "HCLTECH.NS", "WIPRO.NS", "LTIM.NS", "TECHM.NS",
    "PERSISTENT.NS", "COFORGE.NS", "MPHASIS.NS", "TATAELXSI.NS", "KPITTECH.NS",
    "LTTS.NS", "OFSS.NS", "CYIENT.NS", "HAPPSTMNDS.NS", "ZENSARTECH.NS",
    "TCS.NS", "INFY.NS", "HCLTECH.NS", "WIPRO.NS", "TECHM.NS", "LTIM.NS",
    "PERSISTENT.NS", "COFORGE.NS", "MPHASIS.NS", "TATAELXSI.NS", "KPITTECH.NS",
    "LTTS.NS", "OFSS.NS", "CYIENT.NS", "HAPPSTMNDS.NS", "ZENSARTECH.NS",
    "SONATSOFTW.NS", "BSOFT.NS", "NEWGEN.NS", "INTELLECT.NS", "ECLERX.NS", "FIRSTSOURCE.NS", "TANLA.NS", "QUICKHEAL.NS",
    "DATAMATICS.NS", "RATEGAIN.NS",
    "NAZARA.NS", "AFFLE.NS", "FSL.NS", "ROUTE.NS", "MAPMYINDIA.NS",
    "ORACLEFIN.NS"
]

healthcare_list = [
    "SUNPHARMA.NS", "CIPLA.NS", "DRREDDY.NS", "DIVISLAB.NS", "APOLLOHOSP.NS",
    "MAXHEALTH.NS", "MANKIND.NS", "TORNTPHARM.NS", "LUPIN.NS", "AUROPHARMA.NS",
    "ALKEM.NS", "ZYDUSLIFE.NS", "BIOCON.NS", "IPCALAB.NS", "GLENMARK.NS",
    "LAURUSLABS.NS", "LALPATHLAB.NS", "FORTIS.NS", "SYNGENE.NS", "MEDANTA.NS",
    "GLAND.NS", "PFIZER.NS", "ABBOTINDIA.BO", "GSK.NS", "AJANTPHARM.BO", "JUBILANT.NS", "ERIS.NS", "NATCOPHARM.NS",
    "METROPOLIS.NS", "ASTERDM.NS",
    "STAR.NS", "POLYMED.NS", "WOCKPHARMA.NS", "NEULANDLAB.NS", "KRISHNAA.NS",
    "VIJAYA.NS", "SANSERA.NS", "RAINBOW.NS", "PNCINFRA.NS", "AMIORG.NS"
]

fmcg_list = [
    "HINDUNILVR.NS", "ITC.NS", "NESTLEIND.NS", "BRITANNIA.NS", "TATACONSUM.NS",
    "DABUR.NS", "MARICO.NS", "GODREJCP.NS", "COLPAL.NS", "UBL.NS",
    "MCDOWELL-N.NS", "VBL.NS", "EMAMILTD.NS", "PATANJALI.NS", "PGHH.NS",
    "GILLETTE.NS", "RADICO.NS", "BIKAJI.NS"
]

automobile_list = [
    "TATAMOTORS.NS", "MARUTI.NS", "M&M.NS", "BAJAJ-AUTO.NS", "HEROMOTOCO.NS",
    "EICHERMOT.NS", "TVSMOTOR.NS", "ASHOKLEY.NS", "BHARATFORG.NS", "MRF.NS",
    "APOLLOTYRE.NS", "BOSCHLTD.NS", "EXIDEIND.NS", "AMARAJABAT.NS", "SONACOMS.NS",
    "MOTHERSON.NS", "UNOMINDA.NS", "BALKRISIND.NS", "TIINDIA.NS", "CEATLTD.NS"
]

industrials_list = [
    "L&T.NS", "SIEMENS.NS", "ABB.NS", "HAVELLS.NS", "POLYCAB.NS", "BEL.NS",
    "HAL.NS", "BHEL.NS", "CUMMINSIND.NS", "THERMAX.NS", "SKFINDIA.NS",
    "AIAENG.NS", "CGPOWER.NS", "KEI.NS", "DIXON.NS", "ASTRAL.NS",
    "CONCOR.NS", "HONAUT.NS", "BEML.NS", "GRASIM.NS", "ADANIPORTS.NS", "GMRINFRA.NS", "DELHIVERY.NS",
    "BLUEDART.NS", "COCHINSHIP.NS", "MAZDOCK.NS", "BDL.NS", "DATAPATTNS.NS",
    "IRB.NS", "RVNL.NS", "IRFC.NS", "IRCON.NS", "ENGINERSIN.NS", "NBCC.NS",
    "SCHAEFFLER.NS", "TIMKEN.NS", "CARBORUNIV.NS", "GRINDWELL.NS", "KEC.NS"
]

chemicals_list = [
    "PIDILITIND.NS", "SRF.NS", "UPL.NS", "AARTIIND.NS", "DEEPAKNTR.NS",
    "PIIND.NS", "TATACHEM.NS", "ATUL.NS", "NAVINFLUOR.NS", "COROMANDEL.NS",
    "VINATIORGA.NS", "GUJFLUORO.NS", "SUMICHEM.NS", "CLEAN.NS", "SOLARINDS.NS",
    "DEEPAKFERT.NS", "ALKYLAMINE.NS", "CASTROLIND.NS", "BASF.NS", "BAYERCROP.NS"
]

metals_mining_list = [
    "TATASTEEL.NS", "JSWSTEEL.NS", "HINDALCO.NS", "VEDL.NS", "COALINDIA.NS",
    "SAIL.NS", "JINDALSTEL.NS", "HINDZINC.NS", "NATIONALUM.NS", "NMDC.NS",
    "APLAPOLLO.NS", "HINDCOPPER.NS", "JSL.NS", "RATNAMANI.NS", "WELCORP.NS",
    "JSWHL.NS", "MOIL.NS"
]

oil_and_gas_list = [
    "RELIANCE.NS",  # Also in Telecom, but its primary revenue is from O&G
    "ONGC.NS", "IOC.NS", "BPCL.NS", "HPCL.NS", "GAIL.NS", "OIL.NS",
    "IGL.NS", "MGL.NS", "GUJGASLTD.NS", "PETRONET.NS", "ATGL.NS",
    "GSPL.NS", "CHENNPETRO.NS", "MRPL.NS"
]

# --- Real Estate & Infrastructure ---
real_estate_list = [
    "DLF.NS", "GODREJPROP.NS", "MACROTECH.NS",  # Lodha
    "OBEROIRLTY.NS", "PRESTIGE.NS", "PHOENIXLTD.NS", "SOBHA.NS",
    "BRIGADE.NS", "IBREALEST.NS", "MAHLIFE.NS",  # Mahindra Lifespaces
    "SUNTECK.NS", "KEC.NS", "KALPATPOWR.NS", "NBCC.NS"
]

utilities_list = [
    "NTPC.NS", "POWERGRID.NS", "ADANIPOWER.NS", "TATAPOWER.NS", "JSWENERGY.NS",
    "ADANIGREEN.NS", "ADANIENSOL.NS", "NHPC.NS", "SJVN.NS", "TORNTPOWER.NS",
    "BHEL.NS", "RECLTD.NS", "PFC.NS",
    "GAIL.NS", "IGL.NS", "MGL.NS", "GUJGASLTD.NS", "PETRONET.NS", "GSPL.NS",
    "ATGL.NS", "CESC.NS", "GAIL.NS", "GSPL.NS", "GUJGASLTD.NS",
    # Power & Renewables
    "SJVN.NS", "CESC.NS", "INOXWIND.NS", "RTNPOWER.NS", "JPPOWER.NS",
    "NHPC.NS", "KEC.NS", "KALPATPOWR.NS",
    # Others
    "IEX.NS", "COALINDIA.NS"
]

materials_list = [
    "ULTRACEMCO.NS", "GRASIM.NS", "AMBUJACEM.NS", "ACC.NS", "SHREECEM.NS",
    "DALBHARAT.NS", "INDIACEM.NS", "JKCEMENT.NS", "RAMCOCEM.NS", "JSWHL.NS",
    "ASIANPAINT.NS", "BERGEPAINT.NS", "AKZOINDIA.NS", "KANSAINER.NS",
    "SUPREMEIND.NS", "FINPIPE.NS", "PRINCEPIPE.NS", "APLAPOLLO.NS", "ASTRAL.NS", "ULTRACEMCO.NS", "AMBUJACEM.NS", "ACC.NS", "SHREECEM.NS", "DALBHARAT.NS",
    "INDIACEM.NS", "JKCEMENT.NS", "RAMCOCEM.NS", "HEIDELBERG.NS", "BIRLACORPN.NS",
    "GREENPANEL.NS", "CENTURYPLY.NS",
    # Paints & Adhesives
    "ASIANPAINT.NS", "BERGEPAINT.NS", "AKZOINDIA.NS", "KANSAINER.NS", "INDIGOPNTS.NS",
    # Piping & Others
    "SUPREMEIND.NS", "FINPIPE.NS", "PRINCEPIPE.NS"
]

consumer_discretionary_list = [
    # Retail & Durables
    "DMART.NS", "TRENT.NS", "TITAN.NS", "BATAINDIA.NS", "RELAXO.NS", "VEDANTFASH.NS",
    "ADITYAFRL.NS", "VMART.NS", "PAGEIND.NS", "CERA.NS", "KAJARIACER.NS",
    "CROMPTON.NS", "WHIRLPOOL.NS", "TTKPRESTIG.NS", "BLUESTARCO.NS", "AMBER.NS",
    # Media & Entertainment
    "ZEEL.NS", "SUNTV.NS", "PVRINOX.NS", "SAREGAMA.NS", "TV18BRDCST.NS", "NETWORK18.NS",
    # Travel & Leisure
    "INDIGO.NS", "IRCTC.NS", "EASYTRIP.NS", "LEMONTREE.NS", "INDHOTEL.NS", "EIHOTEL.NS",
    "CHALET.NS", "WESTLIFE.NS", "JUBLFOOD.NS", "DEVYANI.NS", "SAPPHIRE.NS"
]


print(len(real_estate_list) + len(oil_and_gas_list) + len(metals_mining_list) + len(chemicals_list) + len(
    industrials_list)
      + len(automobile_list) + len(fmcg_list) + len(healthcare_list) + len(it_services_list) + len(healthcare_list)
      + len(utilities_list) + len(materials_list) + len(consumer_discretionary_list))

all_lists = (
    financial_services_list + it_services_list + healthcare_list + fmcg_list +
    automobile_list + industrials_list + chemicals_list + metals_mining_list +
    oil_and_gas_list + real_estate_list + utilities_list + materials_list +
    consumer_discretionary_list
)
tickers_list_all = sorted(list(set(all_lists)))
print(f"Total number of unique tickers: {len(tickers_list_all)}")

import yfinance as yf
import pandas as pd

# Set pandas to display all columns and more rows for better readability
pd.set_option('display.max_columns', None)
pd.set_option('display.max_rows', 100)
pd.set_option('display.width', 1000)

all_financials_list = []

print("Fetching and combining quarterly financial data...")

# Loop through each ticker in the list
for ticker_symbol in tickers_list_all:
    try:
        # 1. FIX: Set auto_adjust=False to get more complete financial data
        company = yf.Ticker(ticker_symbol)

        # Fetch the quarterly financial statements
        quarterly_financials = company.quarterly_financials

        if quarterly_financials.empty:
            print(f"⚠️ Warning: No quarterly financial data found for {ticker_symbol}.")
            continue

        # Transpose the data to have dates as rows
        quarterly_financials_transposed = quarterly_financials.T

        # 2. FILTER: Keep only data from June 2024 onwards
        # Make sure the index is in datetime format for proper comparison
        quarterly_financials_transposed.index = pd.to_datetime(quarterly_financials_transposed.index)
        filtered_df = quarterly_financials_transposed[quarterly_financials_transposed.index >= '2024-06-01']

        if filtered_df.empty:
            print(f"ℹ️ Info: No data available for {ticker_symbol} on or after June 2024.")
            continue

        # Add a new column to identify the company ticker
        filtered_df['Ticker'] = ticker_symbol

        # Add the processed DataFrame to our list
        all_financials_list.append(filtered_df)

        print(f"✅ Successfully processed data for: {ticker_symbol}")

    except Exception as e:
        print(f"❌ Could not retrieve data for {ticker_symbol}. Error: {e}")

# --- Combine all DataFrames in the list into one ---
if all_financials_list:
    # Use pd.concat to stack the DataFrames
    all_df = pd.concat(all_financials_list)

    print(f"\n{'=' * 60}")
    print("      Combined & Filtered Quarterly Financials DataFrame")
    print("           (Data from June 2024 onwards)")
    print(f"{'=' * 60}\n")
    print(all_df)

    # Save the final combined and filtered data
    all_df.to_csv("all_industries.csv")
    print("\n✅ Combined data has been saved to 'combined_filtered_quarterly_financials.csv'")

else:
    print("\nNo data matched the criteria. The final DataFrame is empty.")

print(f"\n{'=' * 60}")
print("Script finished.")

len(all_df)